{
  "hash": "da0b809a5b6a3a8cf01eb09eedb2b8d6",
  "result": {
    "markdown": "# Preparing the data\n\n> Describe data needs to be in special format to do stuff in R, explain\npivoting. Explain groupping as well, which makes it easier to do \naverage calculations\n\nIn this chapter we start checking and \npreparing the data for future exploration. The qPCR data is special, as\nwe always have technical replicates, meaning we have multiple measures\nof the same sample material. One common step is to average the cycle\nthreshold values of each sample to get a final value. This usually\nworks pretty well, provided there is no outlier. Therefore, it is \nimportant to explore the data and understand what it looks like. \n\nThe following sections will show you how to do some preliminary checks\nof the data and how to create summaries so we can do some\nplots and statistical analysis.\n\n## Loading libraries and files\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(gtsummary)\n\nqpcr <- readRDS(\"../checkpoints/cleaning/qpcr.rds\")\n```\n:::\n\n\n## Exploring some statistics\n\nWe first start by checking the structure of the dataset, number of samples\nby ID, treatment, genotype and more. For this we can pipe the `qpcr`\ndataframe to the function `tbl_summary` from the package `gtsummary`.\nA nice package to use when writing reports.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqpcr %>% gtsummary::tbl_summary()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"zlmmrfjmoa\" style=\"overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#zlmmrfjmoa .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#zlmmrfjmoa .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#zlmmrfjmoa .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#zlmmrfjmoa .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#zlmmrfjmoa .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#zlmmrfjmoa .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#zlmmrfjmoa .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#zlmmrfjmoa .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#zlmmrfjmoa .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#zlmmrfjmoa .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#zlmmrfjmoa .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#zlmmrfjmoa .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#zlmmrfjmoa .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#zlmmrfjmoa .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#zlmmrfjmoa .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#zlmmrfjmoa .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#zlmmrfjmoa .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zlmmrfjmoa .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#zlmmrfjmoa .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#zlmmrfjmoa .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zlmmrfjmoa .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#zlmmrfjmoa .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#zlmmrfjmoa .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#zlmmrfjmoa .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zlmmrfjmoa .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#zlmmrfjmoa .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#zlmmrfjmoa .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#zlmmrfjmoa .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#zlmmrfjmoa .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zlmmrfjmoa .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#zlmmrfjmoa .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zlmmrfjmoa .gt_left {\n  text-align: left;\n}\n\n#zlmmrfjmoa .gt_center {\n  text-align: center;\n}\n\n#zlmmrfjmoa .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#zlmmrfjmoa .gt_font_normal {\n  font-weight: normal;\n}\n\n#zlmmrfjmoa .gt_font_bold {\n  font-weight: bold;\n}\n\n#zlmmrfjmoa .gt_font_italic {\n  font-style: italic;\n}\n\n#zlmmrfjmoa .gt_super {\n  font-size: 65%;\n}\n\n#zlmmrfjmoa .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#zlmmrfjmoa .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#zlmmrfjmoa .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#zlmmrfjmoa .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#zlmmrfjmoa .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#zlmmrfjmoa .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#zlmmrfjmoa .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\">\n  \n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\"><strong>Characteristic</strong></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\"><strong>N = 72</strong><sup class=\"gt_footnote_marks\">1</sup></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td class=\"gt_row gt_left\">sample_id</td>\n<td class=\"gt_row gt_center\"></td></tr>\n    <tr><td class=\"gt_row gt_left\">    20</td>\n<td class=\"gt_row gt_center\">6 (8.3%)</td></tr>\n    <tr><td class=\"gt_row gt_left\">    21</td>\n<td class=\"gt_row gt_center\">6 (8.3%)</td></tr>\n    <tr><td class=\"gt_row gt_left\">    22</td>\n<td class=\"gt_row gt_center\">6 (8.3%)</td></tr>\n    <tr><td class=\"gt_row gt_left\">    23</td>\n<td class=\"gt_row gt_center\">6 (8.3%)</td></tr>\n    <tr><td class=\"gt_row gt_left\">    24</td>\n<td class=\"gt_row gt_center\">6 (8.3%)</td></tr>\n    <tr><td class=\"gt_row gt_left\">    25</td>\n<td class=\"gt_row gt_center\">6 (8.3%)</td></tr>\n    <tr><td class=\"gt_row gt_left\">    26</td>\n<td class=\"gt_row gt_center\">6 (8.3%)</td></tr>\n    <tr><td class=\"gt_row gt_left\">    27</td>\n<td class=\"gt_row gt_center\">6 (8.3%)</td></tr>\n    <tr><td class=\"gt_row gt_left\">    28</td>\n<td class=\"gt_row gt_center\">6 (8.3%)</td></tr>\n    <tr><td class=\"gt_row gt_left\">    29</td>\n<td class=\"gt_row gt_center\">6 (8.3%)</td></tr>\n    <tr><td class=\"gt_row gt_left\">    30</td>\n<td class=\"gt_row gt_center\">6 (8.3%)</td></tr>\n    <tr><td class=\"gt_row gt_left\">    31</td>\n<td class=\"gt_row gt_center\">6 (8.3%)</td></tr>\n    <tr><td class=\"gt_row gt_left\">group</td>\n<td class=\"gt_row gt_center\"></td></tr>\n    <tr><td class=\"gt_row gt_left\">    KO C</td>\n<td class=\"gt_row gt_center\">18 (25%)</td></tr>\n    <tr><td class=\"gt_row gt_left\">    KO T</td>\n<td class=\"gt_row gt_center\">18 (25%)</td></tr>\n    <tr><td class=\"gt_row gt_left\">    WT C</td>\n<td class=\"gt_row gt_center\">18 (25%)</td></tr>\n    <tr><td class=\"gt_row gt_left\">    WT T</td>\n<td class=\"gt_row gt_center\">18 (25%)</td></tr>\n    <tr><td class=\"gt_row gt_left\">genotype</td>\n<td class=\"gt_row gt_center\"></td></tr>\n    <tr><td class=\"gt_row gt_left\">    KO</td>\n<td class=\"gt_row gt_center\">36 (50%)</td></tr>\n    <tr><td class=\"gt_row gt_left\">    WT</td>\n<td class=\"gt_row gt_center\">36 (50%)</td></tr>\n    <tr><td class=\"gt_row gt_left\">treatment</td>\n<td class=\"gt_row gt_center\"></td></tr>\n    <tr><td class=\"gt_row gt_left\">    C</td>\n<td class=\"gt_row gt_center\">36 (50%)</td></tr>\n    <tr><td class=\"gt_row gt_left\">    T</td>\n<td class=\"gt_row gt_center\">36 (50%)</td></tr>\n    <tr><td class=\"gt_row gt_left\">gene</td>\n<td class=\"gt_row gt_center\"></td></tr>\n    <tr><td class=\"gt_row gt_left\">    AKT</td>\n<td class=\"gt_row gt_center\">36 (50%)</td></tr>\n    <tr><td class=\"gt_row gt_left\">    GAPDH</td>\n<td class=\"gt_row gt_center\">36 (50%)</td></tr>\n    <tr><td class=\"gt_row gt_left\">ct</td>\n<td class=\"gt_row gt_center\">17.28 (17.15, 17.65)</td></tr>\n  </tbody>\n  \n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"2\"><sup class=\"gt_footnote_marks\">1</sup> n (%); Median (IQR)</td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n:::\n:::\n\n\nThe next step is to group the data to understand the number of \ntechnical replicates per sample. Sometimes, due to the way the experiment\nruns, some technical replicates are lost. We just want to make sure \nwhat is available for the analysis. \n\nTwo very important functions are used here to summarise the information.\nWe first need to group the rows that we want to summarise. In this case,\nwe want to group by gene, sample ID and also the treatment + genotype.\nThe `group_by` is the one to be used. Usually after using `group_by`, \none can summarise the data using the function `summarise`. In there \nyou create columns similarly to the function `mutate`, but applying\nfunctions to the columns of the grouped dataset. In this case, \nwe use the function `n()` to count the number of rows in the \ngrouped dataframe.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnb_technical_replicates <- qpcr %>% \n    group_by(group, gene, sample_id) %>%\n    summarise(n = n()) \n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'group', 'gene'. You can override using the\n`.groups` argument.\n```\n:::\n:::\n\n\nThe function `tabyl` from the package `janitor` counts the frequency\nof the specified column. In this case, we want to know the frequency of \nthe number of technical replicates.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnb_technical_replicates %>%\n    janitor::tabyl(n) %>%\n    kableExtra::kbl() %>%\n    kableExtra::kable_classic(full_width = FALSE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic\" style='font-family: \"Arial Narrow\", \"Source Sans Pro\", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> n </th>\n   <th style=\"text-align:right;\"> n_n </th>\n   <th style=\"text-align:right;\"> percent </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 24 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nWe see that all samples have 3 technical replicates. If you want\nto inspect the table, the function `head` shows the first\n5 rows of the table.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(nb_technical_replicates)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 4\n# Groups:   group, gene [2]\n  group gene  sample_id     n\n  <chr> <chr> <fct>     <int>\n1 KO C  AKT   26            3\n2 KO C  AKT   27            3\n3 KO C  AKT   28            3\n4 KO C  GAPDH 26            3\n5 KO C  GAPDH 27            3\n6 KO C  GAPDH 28            3\n```\n:::\n:::\n\n\n## Summarizing the data\n\nNow that we saw the data looks fine at the first level, the average\nCT values can be calculated. To do this we again use the function\n`group_by` and `summarise` from the `dplyr` package. \n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"1,2\"}\nsummarised_qpcr <- qpcr %>% \n    group_by(sample_id, gene, group, genotype, treatment) %>%\n    summarise(\n        mean = mean(ct),\n        sd = sd(ct)\n    )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'sample_id', 'gene', 'group', 'genotype'.\nYou can override using the `.groups` argument.\n```\n:::\n:::\n\n## Checkpoint\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsaveRDS(summarised_qpcr, \"../checkpoints/preparing/summarised_qpcr.rds\")\n```\n:::",
    "supporting": [
      "preparing_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}